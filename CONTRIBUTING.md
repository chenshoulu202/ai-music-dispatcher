# è´¡çŒ®æŒ‡å—

æ„Ÿè°¢ä½ å¯¹ AI Music Dispatcher çš„å…³æ³¨ï¼æˆ‘ä»¬æ¬¢è¿å„ç§å½¢å¼çš„è´¡çŒ®ï¼ŒåŒ…æ‹¬ä»£ç ã€æ–‡æ¡£ã€é—®é¢˜æŠ¥å‘Šå’ŒåŠŸèƒ½å»ºè®®ã€‚

## ğŸ“Œ è¡Œä¸ºå‡†åˆ™

æˆ‘ä»¬æ‰¿è¯ºåˆ›å»ºä¸€ä¸ªå‹å¥½ã€åŒ…å®¹çš„ç¯å¢ƒã€‚æ‰€æœ‰å‚ä¸è€…éƒ½åº”è¯¥ï¼š

- å°Šé‡ä»–äººçš„è§‚ç‚¹å’Œç»éªŒ
- æ¥å—å»ºè®¾æ€§çš„æ‰¹è¯„
- å…³æ³¨å¯¹ç¤¾åŒºæœ€æœ‰ç›Šçš„äº‹æƒ…
- å¯¹å…¶ä»–ç¤¾åŒºæˆå‘˜è¡¨ç¤ºåŒæƒ…

## ğŸ› æŠ¥å‘Šé—®é¢˜

åœ¨æŠ¥å‘Šé—®é¢˜æ—¶ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **é—®é¢˜æè¿°** - æ¸…æ¥šåœ°æè¿°é—®é¢˜æ˜¯ä»€ä¹ˆ
2. **å¤ç°æ­¥éª¤** - å¦‚ä½•å¤ç°è¿™ä¸ªé—®é¢˜
3. **é¢„æœŸè¡Œä¸º** - åº”è¯¥å‘ç”Ÿä»€ä¹ˆ
4. **å®é™…è¡Œä¸º** - å®é™…å‘ç”Ÿäº†ä»€ä¹ˆ
5. **ç¯å¢ƒä¿¡æ¯** - Java ç‰ˆæœ¬ã€æ“ä½œç³»ç»Ÿã€MySQL ç‰ˆæœ¬ç­‰
6. **æ—¥å¿—è¾“å‡º** - ç›¸å…³çš„é”™è¯¯æ—¥å¿—

## ğŸ’¡ æå‡ºåŠŸèƒ½å»ºè®®

åœ¨æå‡ºæ–°åŠŸèƒ½å»ºè®®æ—¶ï¼š

1. æ˜ç¡®è¯´æ˜åŠŸèƒ½è§£å†³çš„é—®é¢˜
2. æä¾›å°½å¯èƒ½è¯¦ç»†çš„åŠŸèƒ½æè¿°
3. æä¾›ç¤ºä¾‹ç”¨ä¾‹
4. æŒ‡å‡ºå¯èƒ½çš„æ›¿ä»£æ–¹æ¡ˆ

## ğŸ”§ å¼€å‘æµç¨‹

### 1. Fork ä»“åº“

ç‚¹å‡» GitHub é¡µé¢ä¸Šçš„ "Fork" æŒ‰é’®ï¼Œåˆ›å»ºä½ è‡ªå·±çš„ä»“åº“å‰¯æœ¬ã€‚

### 2. å…‹éš†ä»“åº“

```bash
git clone https://github.com/your-username/ai-music-dispatcher.git
cd ai-music-dispatcher
```

### 3. åˆ›å»ºç‰¹æ€§åˆ†æ”¯

```bash
git checkout -b feature/your-feature-name
```

åˆ†æ”¯å‘½åçº¦å®šï¼š
- `feature/` - æ–°åŠŸèƒ½
- `fix/` - ä¿®å¤é—®é¢˜
- `docs/` - æ–‡æ¡£æ”¹è¿›
- `test/` - æµ‹è¯•ç›¸å…³
- `refactor/` - ä»£ç é‡æ„

### 4. è¿›è¡Œæ”¹åŠ¨

åœ¨å¼€å‘å‰ï¼Œè¯·ç¡®ä¿ç†è§£ä»¥ä¸‹å‡†åˆ™ï¼š

#### ä»£ç é£æ ¼

- ä½¿ç”¨ 2 ä¸ªç©ºæ ¼è¿›è¡Œç¼©è¿›ï¼ˆæˆ–é…ç½®ç¼–è¾‘å™¨ä¸º 2 ç©ºæ ¼ï¼‰
- éµå¾ª Java å‘½åçº¦å®š
- æ·»åŠ å¿…è¦çš„ä»£ç æ³¨é‡Šï¼Œç‰¹åˆ«æ˜¯å¯¹å¤æ‚é€»è¾‘çš„è§£é‡Š
- ä½¿ç”¨ Lombok æ³¨è§£ï¼ˆ@Data, @Slf4j ç­‰ï¼‰ç®€åŒ–ä»£ç 

#### æäº¤ä¿¡æ¯

éµå¾ª [Conventional Commits](https://www.conventionalcommits.org/) è§„èŒƒï¼š

```
<type>(<scope>): <subject>

<body>

<footer>
```

ä¾‹å¦‚ï¼š
```
feat(tts): add voice speed adjustment

Allow users to adjust TTS voice speed through configuration file.
Supports values from -1.0 to 1.0.

Closes #123
```

æäº¤ç±»å‹ï¼š
- `feat` - æ–°åŠŸèƒ½
- `fix` - ä¿®å¤é—®é¢˜
- `docs` - æ–‡æ¡£
- `style` - ä»£ç é£æ ¼
- `refactor` - é‡æ„
- `test` - æµ‹è¯•
- `chore` - æ„å»ºè„šæœ¬ã€ä¾èµ–ç­‰

### 5. æäº¤å¹¶æ¨é€

```bash
git add .
git commit -m "your commit message"
git push origin feature/your-feature-name
```

### 6. å‘èµ· Pull Request

åœ¨ GitHub ä¸Šåˆ›å»º Pull Requestï¼Œå¹¶å¡«å†™ä»¥ä¸‹ä¿¡æ¯ï¼š

- **æ ‡é¢˜** - ç®€æ´æè¿°æ”¹åŠ¨
- **æè¿°** - è¯¦ç»†è¯´æ˜æ”¹åŠ¨å†…å®¹ã€åŸå› å’Œæµ‹è¯•æ–¹æ³•
- **å…³è” Issue** - å¦‚æœæœ‰ç›¸å…³ Issueï¼Œä½¿ç”¨ `Closes #123`

#### PR æ£€æŸ¥æ¸…å•

åœ¨æäº¤ PR å‰ï¼Œè¯·ç¡®ä¿ï¼š

- [ ] ä»£ç éµå¾ªé¡¹ç›®é£æ ¼å‡†åˆ™
- [ ] æ·»åŠ äº†é€‚å½“çš„æµ‹è¯•ç”¨ä¾‹
- [ ] æ›´æ–°äº†ç›¸å…³æ–‡æ¡£
- [ ] æäº¤ä¿¡æ¯æ¸…æ™°æœ‰æ„ä¹‰
- [ ] æ²¡æœ‰å¼•å…¥æ–°çš„ç¼–è¯‘è­¦å‘Š
- [ ] æµ‹è¯•é€šè¿‡ï¼ˆæœ¬åœ°è¿è¡Œ `mvn test`ï¼‰
- [ ] ä»£ç ä¸åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼ˆAPI Keyã€å¯†ç ç­‰ï¼‰

## ğŸ“š æ–‡æ¡£æ”¹è¿›

å¦‚æœä½ å‘ç°æ–‡æ¡£ä¸æ¸…æ¥šæˆ–ç¼ºå¤±ï¼š

1. Fork ä»“åº“
2. ç¼–è¾‘ `README.md` æˆ–å…¶ä»–æ–‡æ¡£æ–‡ä»¶
3. æäº¤ PR å¹¶æè¿°ä½ çš„æ”¹è¿›

## ğŸ¤– æ‰©å±• AI å¤§æ¨¡å‹æ”¯æŒ

å¦‚æœä½ æƒ³æ·»åŠ å¯¹æ–° AI å¤§æ¨¡å‹çš„æ”¯æŒï¼Œä»¥ä¸‹æ˜¯å®Œæ•´æŒ‡å—ï¼š

### æ–¹æ¡ˆ Aï¼šé…ç½®æ–¹å¼æ›¿æ¢ï¼ˆæ¨è - ä»…é…ç½®ï¼Œæ— éœ€ç¼–ç ï¼‰

å¯¹äºå¤§å¤šæ•° API å…¼å®¹æˆ– JSON æ ¼å¼ç›¸ä¼¼çš„æ¨¡å‹ï¼Œä½ å¯ä»¥ç›´æ¥åœ¨ `application.yml` ä¸­é…ç½®ï¼Œæ— éœ€ä¿®æ”¹ä»£ç ï¼š

1. **åœ¨ `application.yml` ä¸­æ›´æ–° API é…ç½®**
   ```yaml
   gemini:
     api-key: "your-new-model-api-key"
     api-url: https://your-model-api-endpoint
     system-prompt: "ä½ çš„è‡ªå®šä¹‰æç¤ºè¯"
   ```

2. **æµ‹è¯•è¿æ¥**
   ```bash
   mvn spring-boot:run
   # æŸ¥çœ‹æ—¥å¿—ç¡®è®¤ API è°ƒç”¨æˆåŠŸ
   ```

**é€‚ç”¨åœºæ™¯**: APIs æ ¼å¼ç›¸ä¼¼çš„æ¨¡å‹ï¼ˆOpenAIã€é€šä¹‰åƒé—®ã€è®¯é£æ˜Ÿç«ç­‰ï¼‰

### æ–¹æ¡ˆ Bï¼šä»£ç æ–¹å¼æ‰©å±•ï¼ˆç”¨äºå®Œå…¨ä¸åŒçš„ API æ ¼å¼ï¼‰

å¦‚æœæ–°æ¨¡å‹çš„ API æ ¼å¼ä¸ Gemini å·®å¼‚å¾ˆå¤§ï¼ˆè¯·æ±‚/å“åº”ç»“æ„ä¸åŒï¼‰ï¼Œéœ€è¦ä¿®æ”¹ `GeminiService.java`ï¼š

1. **ä¿®æ”¹è¯·æ±‚æ„å»ºæ–¹æ³• `buildGeminiRequest()`**
   ```java
   // src/main/java/com/example/aimusicdispatcher/generator/GeminiService.java
   
   private YourModelRequest buildYourModelRequest(String prompt) {
       // æ ¹æ®ä½ çš„æ¨¡å‹ API æ–‡æ¡£æ„å»ºè¯·æ±‚å¯¹è±¡
       YourModelRequest request = new YourModelRequest();
       request.setPrompt(prompt);
       request.setModel("your-model-name");
       request.setMaxTokens(50);
       return request;
   }
   ```

2. **ä¿®æ”¹å“åº”è§£ææ–¹æ³• `extractTextFromGeminiResponse()`**
   ```java
   private String extractTextFromYourModelResponse(YourModelResponse response) {
       // æ ¹æ®ä½ çš„æ¨¡å‹ API æ–‡æ¡£è§£æå“åº”
       if (response.getResult() != null) {
           return response.getResult().getText();
       }
       return FALLBACK_INTRO_TEXT;
   }
   ```

3. **åœ¨ `generateIntroText()` æ–¹æ³•ä¸­ä½¿ç”¨æ–°çš„æ„å»ºå’Œè§£ææ–¹æ³•**
   ```java
   public String generateIntroText(String user, String songName) {
       // ... å‡†å¤‡ prompt ...
       
       YourModelRequest request = buildYourModelRequest(prompt);
       HttpEntity<YourModelRequest> entity = new HttpEntity<>(request, headers);
       
       // ... API è°ƒç”¨ ...
       
       return extractTextFromYourModelResponse(response.getBody());
   }
   ```

4. **åˆ›å»ºå¯¹åº”çš„æ¨¡å‹ DTO ç±»**
   - åœ¨ `src/main/java/com/example/aimusicdispatcher/model/` ä¸‹åˆ›å»ºæ–°æ–‡ä»¶å¤¹ï¼ˆå¦‚ `yourmodel/`ï¼‰
   - åˆ›å»ºå¯¹åº”çš„è¯·æ±‚å’Œå“åº” DTO ç±»
   - å‚è€ƒç°æœ‰çš„ `gemini/` æ–‡ä»¶å¤¹ç»“æ„

5. **æµ‹è¯•å’ŒéªŒè¯**
   ```bash
   mvn clean test
   mvn spring-boot:run
   ```

6. **æäº¤ PR**ï¼ˆå¦‚æœä½ æƒ³è´¡çŒ®ç»™é¡¹ç›®ï¼‰
   - éµå¾ªæäº¤ä¿¡æ¯è§„èŒƒ
   - æ·»åŠ æµ‹è¯•ç”¨ä¾‹
   - æ›´æ–°æ–‡æ¡£è¯´æ˜

### å®Œæ•´ç¤ºä¾‹ï¼šé›†æˆ OpenAI GPT

ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„é›†æˆç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•æ·»åŠ  OpenAI GPT æ”¯æŒï¼š

**Step 1: åˆ›å»ºè¯·æ±‚/å“åº”æ¨¡å‹**
```java
// src/main/java/com/example/aimusicdispatcher/model/openai/OpenAIMessage.java
public class OpenAIMessage {
    private String role;
    private String content;
    // Getters/Setters...
}

// src/main/java/com/example/aimusicdispatcher/model/openai/OpenAIRequest.java
public class OpenAIRequest {
    private String model;
    private List<OpenAIMessage> messages;
    private double temperature;
    private int max_tokens;
    // Getters/Setters...
}

// src/main/java/com/example/aimusicdispatcher/model/openai/OpenAIResponse.java
public class OpenAIResponse {
    private List<Choice> choices;
    
    public static class Choice {
        private OpenAIMessage message;
        // Getters/Setters...
    }
    // Getters/Setters...
}
```

**Step 2: ä¿®æ”¹ GeminiService**
```java
// åœ¨ GeminiService ä¸­æ·»åŠ  OpenAI æ”¯æŒ
private String extractTextFromOpenAIResponse(OpenAIResponse response) {
    if (response.getChoices() != null && !response.getChoices().isEmpty()) {
        return response.getChoices().get(0).getMessage().getContent();
    }
    return FALLBACK_INTRO_TEXT;
}
```

**Step 3: é…ç½®**
```yaml
gemini:
  api-key: "sk-your-openai-key"
  api-url: https://api.openai.com/v1/chat/completions
  system-prompt: "ä½ æ˜¯ä¸€ä¸ªå¹½é»˜é£è¶£çš„ç›´æ’­é—´DJ..."
```

## ğŸ¤ æ‰©å±• TTS æ”¯æŒ

ç±»ä¼¼åœ°ï¼Œå¦‚æœä½ æƒ³æ·»åŠ æ–°çš„ TTS æä¾›å•†ï¼š

### å½“å‰ TTS æ¶æ„

```
TtsService (æ¥å£)
â”œâ”€â”€ EdgeTtsService (Edge TTS å®ç°)
â””â”€â”€ [ä½ çš„è‡ªå®šä¹‰ TTS å®ç°]
```

### æ·»åŠ æ–°çš„ TTS æä¾›å•†

1. **åˆ›å»ºæ–°çš„ TTS å®ç°ç±»**
   ```java
   // src/main/java/com/example/aimusicdispatcher/service/YourTtsService.java
   @Service
   public class YourTtsService implements TtsService {
       @Override
       public void synthesizeAndSave(String text, String outputPath) {
           // ä½ çš„ TTS å®ç°
       }
   }
   ```

2. **åœ¨é…ç½®ä¸­é€‰æ‹© TTS æä¾›å•†**
   ```yaml
   tts:
     provider: your-tts-provider
   ```

3. **åœ¨ `TtsFactory.java` ä¸­æ³¨å†Œæ–°æä¾›å•†**ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
   ```java
   if ("your-tts-provider".equals(provider)) {
       return new YourTtsService(config);
   }
   ```

## ğŸ“¦ æ·»åŠ æ–°ä¾èµ–

å¦‚æœä½ çš„å¤§æ¨¡å‹é›†æˆéœ€è¦æ–°çš„ Maven ä¾èµ–ï¼š

1. **åœ¨ `pom.xml` ä¸­æ·»åŠ **
   ```xml
   <dependency>
       <groupId>com.your.library</groupId>
       <artifactId>your-sdk</artifactId>
       <version>1.0.0</version>
   </dependency>
   ```

2. **æ›´æ–°æ–‡æ¡£** - åœ¨ README çš„ä¾èµ–éƒ¨åˆ†æ·»åŠ è¯´æ˜

3. **æäº¤ PR** - åŒ…å«ä¾èµ–ç‰ˆæœ¬è¯´æ˜å’Œä½¿ç”¨è¯´æ˜


## ğŸ§ª æµ‹è¯•

åœ¨æäº¤ PR å‰ï¼Œè¯·è¿›è¡Œå……åˆ†çš„æµ‹è¯•ï¼š

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
mvn test

# è¿è¡Œç‰¹å®šæµ‹è¯•
mvn test -Dtest=MessageDispatcherTest
```

## ğŸ“› è·å¾—å¸®åŠ©

å¦‚æœä½ åœ¨ä»»ä½•æ—¶å€™éœ€è¦å¸®åŠ©ï¼š

1. æŸ¥çœ‹ç°æœ‰çš„ Issues å’Œ Pull Requests
2. åœ¨ Discussion ä¸­æé—®
3. æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£

## âœ… å®¡æ ¸æµç¨‹

æ‰€æœ‰ Pull Request éƒ½å°†ç»è¿‡ä»¥ä¸‹å®¡æ ¸ï¼š

1. **è‡ªåŠ¨æ£€æŸ¥** - CI æ£€æŸ¥ä»£ç è´¨é‡å’Œæµ‹è¯•é€šè¿‡
2. **äººå·¥å®¡æ ¸** - ä¸»ç»´æŠ¤è€…å®¡æ ¸ä»£ç å’Œè®¾è®¡
3. **å›é¦ˆå’Œæ”¹è¿›** - æ ¹æ®å®¡æ ¸æ„è§è¿›è¡Œå¿…è¦çš„æ”¹åŠ¨
4. **åˆå¹¶** - é€šè¿‡å®¡æ ¸ååˆå¹¶åˆ°ä¸»åˆ†æ”¯

## ğŸ¯ ä¼˜å…ˆçº§

æˆ‘ä»¬å°†æ›´å¿«åœ°å®¡æ ¸å’Œåˆå¹¶ä»¥ä¸‹ç±»å‹çš„ PRï¼š

- ğŸ”´ **é«˜ä¼˜å…ˆçº§**: å®‰å…¨æ¼æ´ã€ä¸¥é‡é—®é¢˜çš„ä¿®å¤
- ğŸŸ¡ **ä¸­ä¼˜å…ˆçº§**: æ–°åŠŸèƒ½ã€é‡è¦çš„ Bug ä¿®å¤ã€æ–‡æ¡£æ”¹è¿›
- ğŸŸ¢ **ä½ä¼˜å…ˆçº§**: ä»£ç ä¼˜åŒ–ã€çç¢çš„æ–‡æ¡£ä¿®æ­£

## ğŸ“‹ å‘å¸ƒæµç¨‹

é¡¹ç›®éµå¾ª Semantic Versioning (semver)ï¼š

- **MAJOR** - ä¸å…¼å®¹çš„ API æ”¹åŠ¨
- **MINOR** - æ–°å¢åŠŸèƒ½ï¼ˆå‘åå…¼å®¹ï¼‰
- **PATCH** - Bug ä¿®å¤ï¼ˆå‘åå…¼å®¹ï¼‰

## ğŸ™ è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰è´¡çŒ®è€…çš„æ”¯æŒï¼ä½ çš„è´¡çŒ®ä½¿è¿™ä¸ªé¡¹ç›®å˜å¾—æ›´å¥½ã€‚

---

å¦‚æœ‰ä»»ä½•ç–‘é—®ï¼Œæ¬¢è¿åœ¨ Issues ä¸­æé—®ï¼
