# é¡¹ç›®é›†æˆæŒ‡å—

## é¡¹ç›®å…¨æ™¯

AI Music Dispatcher ç³»ç»Ÿé‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„ï¼ŒåŒ…å«ä¸¤ä¸ªä¸»è¦ä»“åº“ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ç›´æ’­é—´è§‚ä¼—æµè§ˆå™¨                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ HTTP / WebSocket
                 â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   dycast (å‰ç«¯é¡¹ç›®)     â”‚
    â”‚ ç‚¹æ­Œå’Œå¼¹å¹•äº¤äº’ç•Œé¢      â”‚
    â”‚ GitHub: skmcj/dycast   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ WebSocket + REST API
             â”‚ ws://backend:8080/ws/barrage
             â”‚
             â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  AI Music Dispatcher (åç«¯)      â”‚
    â”‚  This Repository                â”‚
    â”‚  - Gemini AI å£æ’­ç”Ÿæˆ           â”‚
    â”‚  - Edge TTS æ–‡æœ¬è½¬è¯­éŸ³           â”‚
    â”‚  - å¼¹å¹•å¤„ç†å’Œæƒé™ç®¡ç†            â”‚
    â”‚  - éŸ³ä¹åº“ç®¡ç†                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   MySQL æ•°æ®åº“                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å‰ç«¯é¡¹ç›® (dycast)

### é¡¹ç›®ä¿¡æ¯

- **åç§°**: dycast
- **ä»“åº“**: [https://github.com/skmcj/dycast](https://github.com/skmcj/dycast)
- **åŠŸèƒ½**: ç›´æ’­é—´ç‚¹æ­Œå’Œå¼¹å¹•äº¤äº’å‰ç«¯
- **æŠ€æœ¯æ ˆ**: Vue.js / Reactï¼ˆæ ¹æ®é¡¹ç›®å®ç°ï¼‰

### ä¸»è¦åŠŸèƒ½

- ğŸ¤ ç‚¹æ­Œè¯·æ±‚ç•Œé¢
- ğŸ’¬ å®æ—¶å¼¹å¹•æ˜¾ç¤º
- ğŸ é€ç¤¼å’Œç‚¹èµäº¤äº’
- ğŸ”Š éŸ³ä¹æ’­æ”¾æ§åˆ¶
- ğŸ“Š å®æ—¶ç»Ÿè®¡å’Œæƒé™æ˜¾ç¤º

### è·å–å‰ç«¯ä»£ç 

```bash
git clone https://github.com/skmcj/dycast.git
cd dycast
npm install
npm run dev
```

è¯¦ç»†å®‰è£…è¯´æ˜è¯·å‚è€ƒ [dycast é¡¹ç›®æ–‡æ¡£](https://github.com/skmcj/dycast/blob/main/README.md)

## åç«¯é¡¹ç›® (AI Music Dispatcher)

æœ¬é¡¹ç›®æä¾›ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

- ğŸ¤ AI å£æ’­ç”Ÿæˆï¼ˆæ”¯æŒ Geminiã€OpenAIã€Claudeã€é€šä¹‰åƒé—®ç­‰å¤šç§å¤§æ¨¡å‹ï¼‰
- ğŸ”Š æ–‡æœ¬è½¬è¯­éŸ³ï¼ˆEdge TTSï¼‰
- ğŸ’¬ å¼¹å¹•å¤„ç†å’Œåˆ†å‘
- ğŸµ éŸ³ä¹åº“ç®¡ç†
- ğŸ‘¥ æƒé™æ§åˆ¶ç³»ç»Ÿ
- ğŸ“Š æ•°æ®ç¼“å­˜å’Œä¼˜åŒ–

### ğŸ¤– AI å¤§æ¨¡å‹é€‰æ‹©ä¸é…ç½®

ç³»ç»Ÿé»˜è®¤ä½¿ç”¨ Google Geminiï¼Œä½†æ”¯æŒåˆ‡æ¢åˆ°ä»»ä½•å–œæ¬¢çš„å¤§æ¨¡å‹ã€‚

**å¿«é€Ÿé…ç½®ï¼ˆæ— éœ€ä»£ç ä¿®æ”¹ï¼‰ï¼š**

åœ¨ `application.yml` ä¸­æ›´æ–°é…ç½®å³å¯ï¼š

```yaml
# OpenAI GPT
gemini:
  api-key: "sk-your-openai-key"
  api-url: https://api.openai.com/v1/chat/completions

# é˜¿é‡Œé€šä¹‰åƒé—®
gemini:
  api-key: "sk-your-dashscope-key"
  api-url: https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation

# Anthropic Claude
gemini:
  api-key: "sk-ant-your-key"
  api-url: https://api.anthropic.com/v1/messages
```

**éœ€è¦ä»£ç ä¿®æ”¹çš„å¤§æ¨¡å‹ï¼š** 

å¦‚æœä½ çš„å¤§æ¨¡å‹ API æ ¼å¼ä¸ Gemini å·®å¼‚è¾ƒå¤§ï¼Œè¯·å‚è€ƒ [CONTRIBUTING.md](CONTRIBUTING.md#-æ‰©å±•-ai-å¤§æ¨¡å‹æ”¯æŒ) çš„å®Œæ•´å¼€å‘æŒ‡å—ã€‚

æ›´å¤šè¯¦æƒ…è§ [README.md çš„å¤§æ¨¡å‹å®šåˆ¶åŒ–ç« èŠ‚](README.md#-ai-å¤§æ¨¡å‹å®šåˆ¶åŒ–)

### è·å–åç«¯ä»£ç 

```bash
git clone https://github.com/chenshoulu202/ai-music-dispatcher.git
cd ai-music-dispatcher
mvn clean install
mvn spring-boot:run
```

## å‰åç«¯äº¤äº’åè®®

### WebSocket è¿æ¥

#### 1. å‰ç«¯è¿æ¥åç«¯

```javascript
// è¿æ¥åˆ°åç«¯ WebSocket æœåŠ¡
const ws = new WebSocket('ws://localhost:8080/ws/barrage');

ws.onopen = () => {
  console.log('Connected to AI Music Dispatcher');
};

ws.onerror = (error) => {
  console.error('WebSocket error:', error);
};

ws.onclose = () => {
  console.log('Disconnected from server');
};
```

#### 2. å‰ç«¯å‘é€ç‚¹æ­Œè¯·æ±‚

```json
{
  "type": "song_request",
  "userId": "user_id_123",
  "userName": "ç”¨æˆ·æ˜µç§°",
  "songName": "ç®—ä»€ä¹ˆç”·äºº",
  "artistName": "é»„é¾„",
  "timestamp": 1708684800000
}
```

#### 3. å‰ç«¯å‘é€é€ç¤¼äº‹ä»¶

```json
{
  "type": "gift",
  "userId": "user_id_123",
  "userName": "ç”¨æˆ·æ˜µç§°",
  "giftName": "çº¢å¿ƒ",
  "giftIcon": "https://example.com/gift.png",
  "quantity": 5,
  "timestamp": 1708684800000
}
```

#### 4. å‰ç«¯å‘é€ç‚¹èµäº‹ä»¶

```json
{
  "type": "like",
  "userId": "user_id_123",
  "userName": "ç”¨æˆ·æ˜µç§°",
  "count": 10,
  "timestamp": 1708684800000
}
```

#### 5. åç«¯è¿”å›å¤„ç†ç»“æœ

```json
{
  "status": "success",
  "code": "200",
  "message": "ç‚¹æ­ŒæˆåŠŸ",
  "data": {
    "intro": "æ„Ÿè°¢ç”¨æˆ·æ˜µç§°ç‚¹çš„æ­Œã€Šç®—ä»€ä¹ˆç”·äººã€‹ï¼Œé»„é¾„çš„ç»å…¸ä¹‹ä½œï¼Œç¥å¤§å®¶å¬æ­Œæ„‰å¿«ï¼",
    "audioUrl": "https://example.com/tts_output/intro_xxx.mp3",
    "timestamp": 1708684800000
  }
}
```

### REST API ç«¯ç‚¹

#### è·å–éŸ³ä¹åº“

```bash
curl -X GET http://localhost:8080/api/music/library
```

å“åº”ç¤ºä¾‹ï¼š

```json
{
  "code": "200",
  "message": "success",
  "data": [
    {
      "id": 1,
      "name": "ç®—ä»€ä¹ˆç”·äºº",
      "artist": "é»„é¾„",
      "duration": 270,
      "path": "/path/to/music/file.mp3"
    }
  ]
}
```

#### æœç´¢éŸ³ä¹

```bash
curl -X GET http://localhost:8080/api/music/search?keyword=é»„é¾„
```

#### æ£€æŸ¥ç”¨æˆ·æƒé™

```bash
curl -X GET http://localhost:8080/api/permission/check?userId=user_123
```

å“åº”ç¤ºä¾‹ï¼š

```json
{
  "code": "200",
  "message": "success",
  "data": {
    "userId": "user_123",
    "hasPermission": true,
    "reason": "like",
    "remainingTime": 300000,
    "expiresAt": 1708685100000
  }
}
```

## éƒ¨ç½²å’Œè¿è¡Œ

### å¼€å‘ç¯å¢ƒ

#### 1. å¯åŠ¨åç«¯æœåŠ¡

```bash
cd ai-music-dispatcher
mvn spring-boot:run
# æœåŠ¡è¿è¡Œåœ¨ http://localhost:8080
```

#### 2. å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨

```bash
cd dycast
npm run dev
# å‰ç«¯è¿è¡Œåœ¨ http://localhost:5173 æˆ–å…¶ä»–é…ç½®çš„ç«¯å£
```

#### 3. æµ‹è¯•é›†æˆ

æ‰“å¼€æµè§ˆå™¨è®¿é—®å‰ç«¯åœ°å€ï¼Œæ£€æŸ¥ï¼š
- WebSocket è¿æ¥æ˜¯å¦æ­£å¸¸
- ç‚¹æ­Œè¯·æ±‚æ˜¯å¦æˆåŠŸå‘é€
- æ˜¯å¦èƒ½æ¥æ”¶åˆ°åç«¯å“åº”

### ç”Ÿäº§ç¯å¢ƒ

#### ä½¿ç”¨ Docker Compose æ•´ä½“éƒ¨ç½²

åˆ›å»º `docker-compose.prod.yml`ï¼š

```yaml
version: '3.8'

services:
  mysql:
    image: mysql:8.0
    ports:
      - "3306:3306"
    environment:
      MYSQL_ROOT_PASSWORD: root_password
      MYSQL_DATABASE: silver_guardian
      MYSQL_USER: silver_guardian
      MYSQL_PASSWORD: app_password
    volumes:
      - mysql_data:/var/lib/mysql

  backend:
    image: ai-music-dispatcher:latest
    ports:
      - "8080:8080"
    environment:
      SPRING_DATASOURCE_URL: jdbc:mysql://mysql:3306/silver_guardian?useUnicode=true&characterEncoding=utf-8
      SPRING_DATASOURCE_USERNAME: silver_guardian
      SPRING_DATASOURCE_PASSWORD: app_password
      GEMINI_API_KEY: ${GEMINI_API_KEY}
      MUSIC_LOCAL_PATH: /app/music
    depends_on:
      - mysql

  frontend:
    image: dycast:latest
    ports:
      - "80:80"
    environment:
      VITE_API_URL: http://your-backend-url:8080
      VITE_WS_URL: ws://your-backend-url:8080
    depends_on:
      - backend

volumes:
  mysql_data:
```

å¯åŠ¨ï¼š

```bash
docker-compose -f docker-compose.prod.yml up -d
```

## é…ç½®è·¨åŸŸå’Œä»£ç†

### å‰ç«¯é…ç½®ï¼ˆä½¿ç”¨ Nginx åå‘ä»£ç†ï¼‰

```nginx
server {
    listen 80;
    server_name your-domain.com;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /usr/share/nginx/html;
        try_files $uri $uri/ /index.html;
    }

    # ä»£ç†åˆ°åç«¯ API
    location /api {
        proxy_pass http://backend:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # ä»£ç† WebSocket
    location /ws {
        proxy_pass http://backend:8080;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

### åç«¯é…ç½®ï¼ˆSpring Boot CORSï¼‰

åœ¨ `src/main/java/.../config/` ç›®å½•ä¸­åˆ›å»º CORS é…ç½®ï¼š

```java
@Configuration
public class CorsConfig {
    @Bean
    public WebMvcConfigurer corsConfigurer() {
        return new WebMvcConfigurer() {
            @Override
            public void addCorsMappings(CorsRegistry registry) {
                registry.addMapping("/api/**")
                    .allowedOrigins("http://localhost:5173", "https://your-domain.com")
                    .allowedMethods("GET", "POST", "PUT", "DELETE", "OPTIONS")
                    .allowedHeaders("*")
                    .allowCredentials(true)
                    .maxAge(3600);
            }
        };
    }
}
```

## å¸¸è§é—®é¢˜

### Q: å‰åç«¯å¦‚ä½•é€šä¿¡ï¼Ÿ

**A:** é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š
1. **WebSocket**: ç”¨äºå®æ—¶é€šä¿¡ï¼ˆå¼¹å¹•ã€ç‚¹æ­Œï¼‰
2. **REST API**: ç”¨äºæŸ¥è¯¢æ“ä½œï¼ˆæœç´¢éŸ³ä¹ã€æ£€æŸ¥æƒé™ï¼‰

### Q: å‰ç«¯éœ€è¦åšä»€ä¹ˆé…ç½®ï¼Ÿ

**A:** åœ¨ dycast é¡¹ç›®ä¸­é…ç½®åç«¯åœ°å€ï¼š

```javascript
// .env æˆ– .env.local
VITE_API_URL=http://localhost:8080
VITE_WS_URL=ws://localhost:8080
```

### Q: å¦‚ä½•å¤„ç† WebSocket è¿æ¥å¤±è´¥ï¼Ÿ

**A:** æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. åç«¯æ˜¯å¦æ­£å¸¸è¿è¡Œ
2. é˜²ç«å¢™æ˜¯å¦é˜»æ­¢ WebSocket è¿æ¥
3. ä»£ç†é…ç½®æ˜¯å¦æ­£ç¡®å¤„ç†äº† WebSocket å‡çº§è¯·æ±‚
4. å‰åç«¯åœ°å€æ˜¯å¦æ­£ç¡®

### Q: å¦‚ä½•åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ HTTPSï¼Ÿ

**A:** ä½¿ç”¨ Nginx é…ç½® SSL è¯ä¹¦ï¼Œå¹¶åœ¨ç¯å¢ƒå˜é‡ä¸­ä½¿ç”¨ `https://` å’Œ `wss://` åœ°å€ï¼š

```bash
VITE_API_URL=https://your-domain.com
VITE_WS_URL=wss://your-domain.com
```

### Q: å¯ä»¥åˆ†åˆ«éƒ¨ç½²å‰åç«¯å—ï¼Ÿ

**A:** å¯ä»¥ã€‚åªè¦é…ç½®æ­£ç¡®çš„è·¨åŸŸå’Œä»£ç†è§„åˆ™å³å¯ï¼š
- å‰ç«¯å¯ä»¥éƒ¨ç½²åˆ° CDN æˆ–ç‹¬ç«‹æœåŠ¡å™¨
- åç«¯å¯ä»¥éƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨ï¼ˆAWSã€Azureã€é˜¿é‡Œäº‘ç­‰ï¼‰
- ä½¿ç”¨ API Gateway å¤„ç†è·¨åŸŸè¯·æ±‚

## è´¡çŒ®ä»£ç 

å¦‚æœä½ å¯¹ä¸¤ä¸ªé¡¹ç›®éƒ½æœ‰æ”¹è¿›å»ºè®®ï¼š

1. **åç«¯æ”¹è¿›**: åœ¨æœ¬ä»“åº“æäº¤ Issue æˆ– PR
2. **å‰ç«¯æ”¹è¿›**: åœ¨ [dycast](https://github.com/skmcj/dycast) ä»“åº“æäº¤ Issue æˆ– PR
3. **é›†æˆé—®é¢˜**: åœ¨ç›¸å…³ä»“åº“çš„ Issues ä¸­è®¨è®º

## è®¸å¯è¯

- **åç«¯** (AI Music Dispatcher): MIT License
- **å‰ç«¯** (dycast): è¯·å‚è€ƒå…¶ä»“åº“çš„è®¸å¯è¯

## ç›¸å…³èµ„æº

- åç«¯ä»“åº“: [AI Music Dispatcher](https://github.com/chenshoulu202/ai-music-dispatcher)
- å‰ç«¯ä»“åº“: [dycast](https://github.com/skmcj/dycast)
- åç«¯æ–‡æ¡£: [README.md](README.md), [DEPLOYMENT.md](DEPLOYMENT.md)
- å‰ç«¯æ–‡æ¡£: å‚è€ƒ dycast é¡¹ç›®æ–‡æ¡£

---

å¦‚æœ‰é—®é¢˜ï¼Œæ¬¢è¿åœ¨ GitHub Issues ä¸­åé¦ˆï¼
